# VoiceNexus 2.0 æ›´æ–°æ€»ç»“

## ðŸŽ‰ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ï¼ˆv2.0.0ï¼‰æ˜¯ä¸€ä¸ªé‡å¤§ç‰ˆæœ¬å‡çº§ï¼Œä¸»è¦å¢žåŠ äº†**æ™ºèƒ½æƒ…æ„Ÿåˆ†æž**å’Œ**å¤šæƒ…æ„Ÿæ”¯æŒ**åŠŸèƒ½ï¼ŒåŒæ—¶é‡æž„äº†éŸ³è‰²åº“çš„ç›®å½•ç»“æž„ã€‚

## ðŸ“¦ æ–°å¢žæ–‡ä»¶æ¸…å•

### æ ¸å¿ƒä»£ç 

1. **app/services/sentiment.py** - æ™ºèƒ½æƒ…æ„Ÿåˆ†æžæœåŠ¡
   - åŸºäºŽ OpenAI å…¼å®¹ API çš„ LLM è°ƒç”¨
   - å®Œå–„çš„å®¹é”™å’Œå›žé€€æœºåˆ¶
   - å¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒè¶…æ—¶æŽ§åˆ¶

### å·¥å…·è„šæœ¬

2. **scripts/migrate_presets.py** - ç›®å½•ç»“æž„è¿ç§»å·¥å…·
   - è‡ªåŠ¨å°†æ—§çš„æ‰å¹³ç»“æž„è¿ç§»åˆ°æ–°çš„å±‚çº§ç»“æž„
   - æ”¯æŒå¤‡ä»½åŽŸæ–‡ä»¶
   - å¯åˆ›å»ºç¤ºä¾‹ç›®å½•ç»“æž„

3. **scripts/test_smart_sentiment.py** - æƒ…æ„Ÿåˆ†æžæµ‹è¯•å·¥å…·
   - æµ‹è¯• LLM é…ç½®
   - éªŒè¯æƒ…æ„Ÿè¯†åˆ«å‡†ç¡®çŽ‡
   - æ”¯æŒå•æ–‡æœ¬æµ‹è¯•

4. **scripts/quick_start.sh** - å¿«é€Ÿå¯åŠ¨è„šæœ¬
   - è‡ªåŠ¨æ£€æŸ¥çŽ¯å¢ƒ
   - éªŒè¯é…ç½®
   - ä¸€é”®å¯åŠ¨æœåŠ¡

### æ–‡æ¡£

5. **SMART_SENTIMENT_GUIDE.md** - æ™ºèƒ½æƒ…æ„Ÿåˆ†æžå®Œæ•´æŒ‡å—
   - è¯¦ç»†çš„é…ç½®è¯´æ˜Ž
   - æ”¯æŒçš„ LLM æœåŠ¡ä»‹ç»
   - ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®žè·µ
   - æ•…éšœæŽ’æŸ¥æŒ‡å—

6. **QUICK_START.md** - å¿«é€Ÿå¼€å§‹æŒ‡å—
   - 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
   - åˆ†æ­¥éª¤è¯´æ˜Ž
   - å¸¸è§é—®é¢˜è§£ç­”

7. **PROJECT_OVERVIEW.md** - é¡¹ç›®æ€»è§ˆ
   - å®Œæ•´çš„æŠ€æœ¯æž¶æž„
   - æ•°æ®æµç¨‹è¯´æ˜Ž
   - å¼€å‘å’Œæ‰©å±•æŒ‡å—

8. **CHANGELOG.md** - æ›´æ–°æ—¥å¿—
   - ç‰ˆæœ¬åŽ†å²
   - åŠŸèƒ½å˜æ›´è®°å½•
   - æœªæ¥è®¡åˆ’

9. **DEPLOYMENT_CHECKLIST.md** - éƒ¨ç½²æ£€æŸ¥æ¸…å•
   - å®Œæ•´çš„éƒ¨ç½²æ­¥éª¤
   - åŠŸèƒ½æµ‹è¯•æ¸…å•
   - æ•…éšœæŽ’æŸ¥æŒ‡å—

10. **UPDATE_SUMMARY.md** - æœ¬æ–‡æ¡£

## ðŸ”„ ä¿®æ”¹çš„æ–‡ä»¶

### é…ç½®æ–‡ä»¶

1. **app/core/config.py**
   - æ–°å¢žæ™ºèƒ½æƒ…æ„Ÿåˆ†æžç›¸å…³é…ç½®
   - æ–°å¢ž LLM API é…ç½®é¡¹
   - æ–°å¢žæƒ…æ„Ÿæ ‡ç­¾ç™½åå•é…ç½®

2. **.env.example**
   - æ–°å¢žæ™ºèƒ½æƒ…æ„Ÿåˆ†æžé…ç½®ç¤ºä¾‹
   - æ›´æ–°é…ç½®è¯´æ˜Ž

3. **requirements.txt**
   - æ–°å¢ž `openai>=1.0.0` ä¾èµ–

### æ ¸å¿ƒä»£ç 

4. **app/core/inference.py**
   - é‡æž„ `_get_reference_audio_path` æ–¹æ³•ï¼Œæ”¯æŒæ–°çš„å±‚çº§ç»“æž„
   - æ›´æ–° `generate` æ–¹æ³•ï¼Œæ”¯æŒæƒ…æ„Ÿå‚æ•°
   - æ–°å¢žæ™ºèƒ½æƒ…æ„Ÿåˆ†æžé›†æˆ
   - å¢žå¼ºçš„é™çº§é€»è¾‘å’Œé”™è¯¯å¤„ç†

5. **app/models/schemas.py**
   - `TTSRequest` æ–°å¢ž `emotion` å­—æ®µ
   - `VoiceInfo` é‡æž„ï¼Œæ–°å¢ž `emotions` å’Œ `has_default` å­—æ®µ
   - `UploadResponse` æ–°å¢ž `emotion` å­—æ®µ

6. **app/main.py**
   - æ›´æ–° `get_voices` æŽ¥å£ï¼Œæ”¯æŒæ–°çš„ç›®å½•ç»“æž„
   - æ›´æ–° `create_speech` æŽ¥å£ï¼Œæ”¯æŒæƒ…æ„Ÿå‚æ•°
   - æ›´æ–° `upload_voice` æŽ¥å£ï¼Œæ”¯æŒå±‚çº§ç›®å½•

### æµ‹è¯•å’Œå·¥å…·

7. **test_api.py**
   - æ–°å¢žæ™ºèƒ½æƒ…æ„Ÿåˆ†æžæµ‹è¯•
   - æ–°å¢žå¤šæƒ…æ„Ÿæµ‹è¯•ç”¨ä¾‹
   - æ›´æ–°ä¸Šä¼ æŽ¥å£æµ‹è¯•

8. **scripts/create_default_voice.py**
   - æ›´æ–°ä¸ºæ”¯æŒæ–°çš„å±‚çº§ç»“æž„

9. **scripts/setup.sh**
   - æ›´æ–°åˆå§‹åŒ–é€»è¾‘

### æ–‡æ¡£

10. **README.md**
    - æ–°å¢žæ–‡æ¡£å¯¼èˆª
    - æ›´æ–°ç‰¹æ€§åˆ—è¡¨
    - æ›´æ–° API æ–‡æ¡£
    - æ›´æ–°å¸¸è§é—®é¢˜

11. **INTEGRATION_GUIDE.md**
    - æ›´æ–°é›†æˆæ­¥éª¤
    - æ–°å¢žæƒ…æ„ŸæŽ§åˆ¶è¯´æ˜Ž

## âœ¨ ä¸»è¦åŠŸèƒ½å˜æ›´

### 1. æ™ºèƒ½æƒ…æ„Ÿåˆ†æž

**åŠŸèƒ½æè¿°ï¼š**
- ä½¿ç”¨ LLMï¼ˆå¦‚ Gemini Flashï¼‰è‡ªåŠ¨åˆ†æžæ–‡æœ¬æƒ…æ„Ÿ
- æ”¯æŒ OpenAI å…¼å®¹çš„ API æŽ¥å£
- è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æƒ…æ„ŸéŸ³è‰²

**ä½¿ç”¨æ–¹å¼ï¼š**
```json
{
  "input": "å¤ªæ£’äº†ï¼æˆ‘çœŸçš„å¾ˆå¼€å¿ƒï¼",
  "voice": "girl_01",
  "emotion": "auto"  // è‡ªåŠ¨åˆ†æž
}
```

**é…ç½®ï¼š**
```env
ENABLE_SMART_SENTIMENT=true
SENTIMENT_LLM_API_KEY=your-api-key
SENTIMENT_LLM_MODEL=gemini-1.5-flash
```

### 2. å¤šæƒ…æ„Ÿæ”¯æŒ

**åŠŸèƒ½æè¿°ï¼š**
- æ¯ä¸ªéŸ³è‰²æ”¯æŒå¤šç§æƒ…æ„Ÿè¡¨è¾¾
- æ”¯æŒçš„æƒ…æ„Ÿï¼šhappy, sad, angry, fear, surprise, neutral, default
- å¯è‡ªå®šä¹‰æƒ…æ„Ÿæ ‡ç­¾

**ç›®å½•ç»“æž„ï¼š**
```
presets/
â””â”€â”€ girl_01/
    â”œâ”€â”€ default.wav   # å¿…éœ€
    â”œâ”€â”€ happy.wav
    â”œâ”€â”€ sad.wav
    â””â”€â”€ angry.wav
```

**ä½¿ç”¨æ–¹å¼ï¼š**
```json
{
  "input": "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼",
  "voice": "girl_01",
  "emotion": "happy"  // æ‰‹åŠ¨æŒ‡å®š
}
```

### 3. æ–°çš„ç›®å½•ç»“æž„

**æ—§ç»“æž„ï¼ˆä»ç„¶å…¼å®¹ï¼‰ï¼š**
```
presets/
â”œâ”€â”€ voice_01.wav
â””â”€â”€ voice_02.wav
```

**æ–°ç»“æž„ï¼ˆæŽ¨èï¼‰ï¼š**
```
presets/
â”œâ”€â”€ voice_01/
â”‚   â”œâ”€â”€ default.wav
â”‚   â”œâ”€â”€ happy.wav
â”‚   â””â”€â”€ sad.wav
â””â”€â”€ voice_02/
    â””â”€â”€ default.wav
```

**è¿ç§»å·¥å…·ï¼š**
```bash
python scripts/migrate_presets.py
```

## ðŸ”§ API å˜æ›´

### 1. GET /v1/voices

**æ—§å“åº”ï¼š**
```json
{
  "voices": [
    {
      "id": "girl_01",
      "filename": "girl_01.wav",
      "name": "girl_01"
    }
  ]
}
```

**æ–°å“åº”ï¼š**
```json
{
  "voices": [
    {
      "id": "girl_01",
      "name": "girl_01",
      "emotions": ["default", "happy", "sad"],
      "has_default": true
    }
  ]
}
```

### 2. POST /v1/audio/speech

**æ–°å¢žå‚æ•°ï¼š**
- `emotion`: æƒ…æ„Ÿæ ‡ç­¾ï¼ˆ"auto", "default", "happy", "sad" ç­‰ï¼‰

**ç¤ºä¾‹ï¼š**
```json
{
  "input": "æ–‡æœ¬å†…å®¹",
  "voice": "girl_01",
  "emotion": "auto",  // æ–°å¢ž
  "response_format": "wav",
  "speed": 1.0
}
```

### 3. POST /v1/voices/upload

**æ–°å¢žå‚æ•°ï¼š**
- `voice_id`: éŸ³è‰²IDï¼ˆæ–‡ä»¶å¤¹åï¼‰
- `emotion`: æƒ…æ„Ÿæ ‡ç­¾ï¼ˆæ–‡ä»¶åï¼‰

**ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://localhost:5050/v1/voices/upload \
  -F "file=@audio.wav" \
  -F "voice_id=girl_01" \
  -F "emotion=happy"
```

## ðŸ“Š é…ç½®å˜æ›´

### æ–°å¢žçŽ¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜Ž | é»˜è®¤å€¼ |
|------|------|--------|
| `ENABLE_SMART_SENTIMENT` | å¯ç”¨æ™ºèƒ½æƒ…æ„Ÿåˆ†æž | `true` |
| `SENTIMENT_LLM_BASE_URL` | LLM API åœ°å€ | Gemini API |
| `SENTIMENT_LLM_API_KEY` | LLM API Key | - |
| `SENTIMENT_LLM_MODEL` | LLM æ¨¡åž‹ | `gemini-1.5-flash` |
| `SENTIMENT_LABELS` | æ”¯æŒçš„æƒ…æ„Ÿæ ‡ç­¾ | `[...]` |
| `SENTIMENT_TIMEOUT` | è¯·æ±‚è¶…æ—¶æ—¶é—´ | `10` |

## ðŸ”„ å‘åŽå…¼å®¹æ€§

### å®Œå…¨å…¼å®¹

âœ… æ—§çš„æ‰å¹³ç›®å½•ç»“æž„ä»ç„¶æ”¯æŒ  
âœ… ä¸æŒ‡å®š `emotion` å‚æ•°æ—¶é»˜è®¤ä½¿ç”¨ `"default"`  
âœ… æ—§çš„ API è°ƒç”¨æ–¹å¼å®Œå…¨æœ‰æ•ˆ  
âœ… æ— éœ€ä¿®æ”¹çŽ°æœ‰å®¢æˆ·ç«¯ä»£ç 

### æŽ¨èå‡çº§

è™½ç„¶å®Œå…¨å…¼å®¹ï¼Œä½†å»ºè®®ï¼š
1. è¿ç§»åˆ°æ–°çš„å±‚çº§ç›®å½•ç»“æž„
2. å¯ç”¨æ™ºèƒ½æƒ…æ„Ÿåˆ†æžåŠŸèƒ½
3. ä¸ºæ¯ä¸ªéŸ³è‰²å‡†å¤‡å¤šç§æƒ…æ„ŸéŸ³é¢‘

## ðŸ“ˆ æ€§èƒ½å½±å“

### æ™ºèƒ½æƒ…æ„Ÿåˆ†æž

- **é¢å¤–å»¶è¿Ÿ**: 0.5-2 ç§’ï¼ˆå–å†³äºŽ LLM å“åº”é€Ÿåº¦ï¼‰
- **å¯é€‰åŠŸèƒ½**: å¯é€šè¿‡é…ç½®ç¦ç”¨
- **å¼‚æ­¥å¤„ç†**: ä¸é˜»å¡žå…¶ä»–è¯·æ±‚

### ç›®å½•ç»“æž„

- **æ— æ€§èƒ½å½±å“**: æ–‡ä»¶æŸ¥æ‰¾é€»è¾‘ä¼˜åŒ–
- **å‘åŽå…¼å®¹**: è‡ªåŠ¨æ£€æµ‹å¹¶æ”¯æŒæ—§ç»“æž„

## ðŸš€ å‡çº§æ­¥éª¤

### å¯¹äºŽæ–°ç”¨æˆ·

ç›´æŽ¥æŒ‰ç…§ [QUICK_START.md](./QUICK_START.md) å¼€å§‹ä½¿ç”¨ã€‚

### å¯¹äºŽçŽ°æœ‰ç”¨æˆ·

1. **æ›´æ–°ä»£ç **
   ```bash
   git pull
   pip install -r requirements.txt
   ```

2. **æ›´æ–°é…ç½®**
   ```bash
   # å¤‡ä»½æ—§é…ç½®
   cp .env .env.backup
   
   # æ·»åŠ æ–°é…ç½®é¡¹
   cat >> .env << EOF
   ENABLE_SMART_SENTIMENT=true
   SENTIMENT_LLM_API_KEY=your-api-key
   SENTIMENT_LLM_MODEL=gemini-1.5-flash
   EOF
   ```

3. **è¿ç§»éŸ³è‰²æ–‡ä»¶**ï¼ˆå¯é€‰ï¼‰
   ```bash
   python scripts/migrate_presets.py
   ```

4. **é‡å¯æœåŠ¡**
   ```bash
   docker-compose down
   docker-compose up -d --build
   ```

5. **æµ‹è¯•åŠŸèƒ½**
   ```bash
   python test_api.py
   ```

## ðŸ§ª æµ‹è¯•å»ºè®®

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:5050/

# æµ‹è¯•éŸ³è‰²åˆ—è¡¨
curl http://localhost:5050/v1/voices

# æµ‹è¯•è¯­éŸ³åˆæˆ
python test_api.py
```

### 2. æ™ºèƒ½æƒ…æ„Ÿæµ‹è¯•

```bash
# æµ‹è¯•é…ç½®
python scripts/test_smart_sentiment.py --config-only

# æµ‹è¯•æƒ…æ„Ÿåˆ†æž
python scripts/test_smart_sentiment.py

# æµ‹è¯•å•ä¸ªæ–‡æœ¬
python scripts/test_smart_sentiment.py --text "å¤ªæ£’äº†ï¼"
```

### 3. ç›®å½•ç»“æž„æµ‹è¯•

```bash
# æµ‹è¯•è¿ç§»å·¥å…·
python scripts/migrate_presets.py

# éªŒè¯æ–°ç»“æž„
ls -la presets/*/
```

## ðŸ“ æ³¨æ„äº‹é¡¹

### 1. API Key å®‰å…¨

- âš ï¸ ä¸è¦å°† API Key æäº¤åˆ°ç‰ˆæœ¬æŽ§åˆ¶
- âš ï¸ ä½¿ç”¨çŽ¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
- âš ï¸ å®šæœŸè½®æ¢ API Key

### 2. éŸ³è‰²æ–‡ä»¶

- âš ï¸ æ¯ä¸ªéŸ³è‰²æ–‡ä»¶å¤¹å¿…é¡»åŒ…å« `default.wav`
- âš ï¸ æƒ…æ„Ÿæ–‡ä»¶åå¿…é¡»ä¸Žé…ç½®çš„æ ‡ç­¾ä¸€è‡´
- âš ï¸ éŸ³é¢‘æ–‡ä»¶åº”è¯¥æ˜¯æ¸…æ™°çš„äººå£°å½•éŸ³

### 3. æ€§èƒ½è€ƒè™‘

- âš ï¸ æ™ºèƒ½æƒ…æ„Ÿåˆ†æžä¼šå¢žåŠ å»¶è¿Ÿ
- âš ï¸ å¯ä»¥é€šè¿‡é…ç½®ç¦ç”¨æ­¤åŠŸèƒ½
- âš ï¸ è€ƒè™‘ä½¿ç”¨æ›´å¿«çš„ LLM æ¨¡åž‹

## ðŸŽ¯ ä¸‹ä¸€æ­¥

1. **é˜…è¯»æ–‡æ¡£**
   - [å¿«é€Ÿå¼€å§‹](./QUICK_START.md)
   - [æ™ºèƒ½æƒ…æ„ŸæŒ‡å—](./SMART_SENTIMENT_GUIDE.md)
   - [é¡¹ç›®æ€»è§ˆ](./PROJECT_OVERVIEW.md)

2. **é…ç½®æœåŠ¡**
   - èŽ·å– Gemini API Key
   - å‡†å¤‡éŸ³è‰²æ–‡ä»¶
   - é…ç½®çŽ¯å¢ƒå˜é‡

3. **æµ‹è¯•åŠŸèƒ½**
   - è¿è¡Œæµ‹è¯•è„šæœ¬
   - å°è¯•ä¸åŒçš„æƒ…æ„Ÿ
   - éªŒè¯ API å“åº”

4. **é›†æˆåº”ç”¨**
   - æ›´æ–°å®¢æˆ·ç«¯ä»£ç 
   - æµ‹è¯•æ–°åŠŸèƒ½
   - éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒ

## ðŸ’¬ åé¦ˆå’Œæ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼š

- ðŸ“– æŸ¥çœ‹ [å®Œæ•´æ–‡æ¡£](./README.md)
- ðŸ” æŸ¥çœ‹ [æ•…éšœæŽ’æŸ¥](./PROJECT_OVERVIEW.md#æ•…éšœæŽ’æŸ¥)
- ðŸ’¬ æäº¤ [Issue](https://github.com/your-repo/issues)
- ðŸ“§ å‘é€é‚®ä»¶åˆ° your-email@example.com

## ðŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒï¼

---

**æ›´æ–°ç‰ˆæœ¬**: 2.0.0  
**å‘å¸ƒæ—¥æœŸ**: 2025-01-22  
**æ–‡æ¡£ä½œè€…**: VoiceNexus Team
